<div class="container">
  <h1>Gestão de Escalas e Manifestos</h1>

  <mat-tab-group
    [(selectedIndex)]="tabIndex"
    (selectedIndexChange)="tabChanged($event)"
  >
    <!-- Tab de Escalas -->
    <mat-tab label="Escalas">
      <div class="tab-content">
        <mat-form-field
          appearance="outline"
          floatLabel="always"
          class="search-field"
        >
          <mat-label>Filtrar escalas</mat-label>
          <input
            matInput
            [(ngModel)]="filtroEscalas"
            placeholder="Digite para filtrar..."
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <div class="mat-elevation-z8 table-container">
          <table mat-table [dataSource]="escalasFiltradas" matSort>
            <!-- Coluna Navio -->
            <ng-container matColumnDef="navio">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Navio</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                {{ escala.navio }}
              </td>
            </ng-container>

            <!-- Coluna Porto -->
            <ng-container matColumnDef="porto">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Porto</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                {{ escala.porto }}
              </td>
            </ng-container>

            <!-- Coluna Status -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                <span class="status-badge" [class]="'status-' + escala.status">
                  {{ getStatusEscala(escala.status) }}
                </span>
              </td>
            </ng-container>

            <!-- Coluna ETA -->
            <ng-container matColumnDef="eta">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>ETA</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                {{ formatarData(escala.eta) }}
              </td>
            </ng-container>

            <!-- Coluna ETB -->
            <ng-container matColumnDef="etb">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>ETB</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                {{ formatarData(escala.etb) }}
              </td>
            </ng-container>

            <!-- Coluna ETD -->
            <ng-container matColumnDef="etd">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>ETD</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                {{ formatarData(escala.etd) }}
              </td>
            </ng-container>

            <!-- Coluna Manifestos -->
            <ng-container matColumnDef="manifestos">
              <th mat-header-cell *matHeaderCellDef>Manifestos Vinculados</th>
              <td
                mat-cell
                *matCellDef="let escala"
                (click)="openDetails('escala', escala.id)"
              >
                <span
                  *ngIf="escala.manifestosVinculados.length > 0"
                  class="vinculado"
                >
                  {{ escala.manifestosVinculados.length }} manifesto(s)
                </span>
                <span
                  *ngIf="escala.manifestosVinculados.length === 0"
                  class="nao-vinculado"
                >
                  Nenhum manifesto
                </span>
              </td>
            </ng-container>

            <!-- Coluna Ações -->
            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef class="actions-header">
                Ações
              </th>
              <td mat-cell *matCellDef="let escala" class="actions-cell">
                <button
                  (click)="gerenciarVinculacaoEscala(escala)"
                  class="meuButtonAction"
                  [ngStyle]="{
                    'background-color':
                      escala.manifestosVinculados.length <= 0 ? '#0ea800' : ''
                  }"
                >
                  {{
                    escala.manifestosVinculados.length > 0
                      ? "Editar Vinculação"
                      : "Adicionar Vinculação"
                  }}
                </button>
              </td>
            </ng-container>

            <!-- Header e Row -->
            <tr mat-header-row *matHeaderRowDef="displayedColumnsEscalas"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsEscalas"
            ></tr>
          </table>
        </div>
      </div>
    </mat-tab>

    <!-- Tab de Manifestos -->
    <mat-tab label="Manifestos">
      <div class="tab-content">
        <mat-form-field
          appearance="outline"
          floatLabel="always"
          class="search-field"
        >
          <mat-label>Filtrar manifestos</mat-label>
          <input
            matInput
            [(ngModel)]="filtroManifestos"
            placeholder="Digite para filtrar..."
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <div class="mat-elevation-z8 table-container">
          <table mat-table [dataSource]="manifestosFiltrados" matSort>
            <!-- Coluna Número -->
            <ng-container matColumnDef="numero">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Número</th>
              <td
                mat-cell
                *matCellDef="let manifesto"
                (click)="openDetails('manifesto', manifesto.id)"
              >
                {{ manifesto.numero }}
              </td>
            </ng-container>

            <!-- Coluna Tipo -->
            <ng-container matColumnDef="tipo">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo</th>
              <td
                mat-cell
                *matCellDef="let manifesto"
                (click)="openDetails('manifesto', manifesto.id)"
              >
                <span class="tipo-badge" [class]="'tipo-' + manifesto.tipo">
                  {{ getTipoText(manifesto.tipo) }}
                </span>
              </td>
            </ng-container>

            <!-- Coluna Navio -->
            <ng-container matColumnDef="navio">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Navio</th>
              <td
                mat-cell
                *matCellDef="let manifesto"
                (click)="openDetails('manifesto', manifesto.id)"
              >
                {{ manifesto.navio }}
              </td>
            </ng-container>

            <!-- Coluna Porto Origem -->
            <ng-container matColumnDef="portoOrigem">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                Porto de Origem
              </th>
              <td
                mat-cell
                *matCellDef="let manifesto"
                (click)="openDetails('manifesto', manifesto.id)"
              >
                {{ manifesto.portoOrigem }}
              </td>
            </ng-container>

            <!-- Coluna Porto Destino -->
            <ng-container matColumnDef="portoDestino">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                Porto de Destino
              </th>
              <td
                mat-cell
                *matCellDef="let manifesto"
                (click)="openDetails('manifesto', manifesto.id)"
              >
                {{ manifesto.portoDestino }}
              </td>
            </ng-container>

            <!-- Coluna Escalas -->
            <ng-container matColumnDef="escalas">
              <th mat-header-cell *matHeaderCellDef>Escalas Vinculadas</th>
              <td
                mat-cell
                *matCellDef="let manifesto"
                (click)="openDetails('manifesto', manifesto.id)"
              >
                <span
                  *ngIf="manifesto.escalasVinculadas.length > 0"
                  class="vinculado"
                >
                  {{ manifesto.escalasVinculadas.length }} escala(s)
                </span>
                <span
                  *ngIf="manifesto.escalasVinculadas.length === 0"
                  class="nao-vinculado"
                >
                  Nenhuma escala
                </span>
              </td>
            </ng-container>

            <!-- Coluna Ações -->
            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef class="actions-header">
                Ações
              </th>
              <td mat-cell *matCellDef="let manifesto" class="actions-cell">
                <button
                  (click)="gerenciarVinculacaoManifesto(manifesto)"
                  class="meuButtonAction"
                  [ngStyle]="{
                    'background-color':
                      manifesto.escalasVinculadas.length <= 0 ? '#0ea800' : ''
                  }"
                >
                  {{
                    manifesto.escalasVinculadas.length > 0
                      ? "Editar Vinculação"
                      : "Adicionar Vinculação"
                  }}
                </button>
              </td>
            </ng-container>

            <!-- Header e Row -->
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsManifestos"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsManifestos"
            ></tr>
          </table>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<router-outlet></router-outlet>
